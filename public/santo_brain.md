# üê∑ SANTO CERDO ‚Äî Biblia Operativa & Ecosistema (Santo Brain)

**Fecha:** 25 Noviembre 2025
**Versi√≥n:** v7.0 ‚Äî Definitive Edition

---

## Introducci√≥n r√°pida
**Concepto:** Sistema Operativo Gastron√≥mico Unipersonal (SaaS) ‚Äî Modelo Pure Take-Away.

**Arquitectura:** SPA + Infraestructura F√≠sica Fail-Safe.

**Misi√≥n:** Un organismo vivo que protege al piloto del colapso, maximiza el flujo de caja y aprende de cada servicio.

**Filosof√≠a:** "High Tech, High Touch, Zero Friction".

Este documento es doble: sirve como Biblia Operativa (procedimientos, UX, hardware, playbook) y como Plan de Funcionalidades (backlog t√©cnico, plantillas, roadmap). Mant√©n ambas partes sincronizadas: cada cambio operativo relevante debe generar o actualizar una historia de usuario.

---

## üé® PARTE 1: IDENTIDAD Y ALMA (Branding & UX)
Dise√±ado para la noche, la velocidad y la seducci√≥n. Sin esto, solo somos una cocina fantasma m√°s.

### 1.1 Identidad Visual (Look & Feel)
- üåë Fondo: `#121212` (Negro Carb√≥n). Modo oscuro absoluto. Nada de blanco cl√≠nico.
- üê∑ Acento Acci√≥n: `#FF0099` (Neon Pig). Botones de compra, alertas cr√≠ticas y el "Bot√≥n Rojo".
- üçû Acento Dinero: `#FFD700` (Dorado Brioche). Precios, upselling y recompensas.

### 1.2 Tipograf√≠a de Combate
- **ANTON:** Gritos/Titulares. Grande, may√∫sculas. Para nombres de burgers y alertas.
- **Roboto Mono:** Datos/Tiempos. T√©cnica, fr√≠a. Para tiempos de espera, precios y tickets.

### 1.3 Tono de Voz (Copywriting)
Personalidad: Canalla, directo, irreverente.

Regla de Oro: Jam√°s pedimos "por favor" ni decimos "lo sentimos". Retamos al ego del cliente.

- Mal: "Disculpe las molestias, no nos quedan patatas." 
- Bien: "ü•î MUNICI√ìN AGOTADA. Las chips han volado. O traes las tuyas o comes a palo seco."

---

## üèóÔ∏è PARTE 2: LA FORTALEZA (Infraestructura Cr√≠tica)
Hardware y flujo f√≠sico. Sin esto, el software no respira. Prioridad Absoluta.

### 2.1 El Cortafuegos (Red Fail-Safe)
- **Hardware:** Router Industrial 4G/5G con SIM propia (independiente de la fibra del local).
- **Protocolo:** Si la fibra cae, el 4G entra en 0.2 segundos. Stripe y Supabase nunca pierden conexi√≥n.
- **Objetivo:** El negocio no puede morir porque Telef√≥nica tenga un mal d√≠a.

### 2.2 Gesti√≥n del Flujo F√≠sico (Crowd Control)
La tecnolog√≠a no sirve si la gente estorba en el pasillo.

- **El Carril R√°pido (Muro QR):** Vinilo gigante antes del mostrador. Funci√≥n: "Salta la cola". Copy: "¬øTienes prisa? Escanea, pide y adelanta a los indecisos." 
- **Se√±al√©tica de Suelo (Floor Marking):**
  - L√≠nea A (Izquierda): "üëá PIDE AQU√ç" (Kiosco/Tablet fija).
  - L√≠nea B (Derecha): "ü•° ESPERA TU DROGA AQU√ç" (Zona de Recogida).

---

## üì± PARTE 3: LA INTERFAZ CLIENTE (El Cebo)
Entrada de pedidos y psicolog√≠a de precios.

### 3.1 Barrera de Entrada & Pricing
- **Precio Digital (11‚Ç¨):** Ahorra 1‚Ç¨ al pedir y pagar por QR o Kiosco ‚Äî recompensa por autoservicio.

### 3.2 Features de Compra (Upselling Agresivo)
- üçî **La Ruleta del Hambre:** Selecci√≥n aleatoria para indecisos.
- üçü **Upselling "Reto al Ego":** Trigger al pagar solo burger. Copy: "¬øVas a dejar que esa burger se vaya sola a casa?" (S√≠ / No).
- üì¶ **Selector de Log√≠stica:**
  - Opci√≥n A: ü•° Bolsa (Precintada).
  - Opci√≥n B: üèÉ Comer Andando (En mano, sin bolsa. Ahorra 20s de packing y 0,50‚Ç¨).

---

## üß† PARTE 4: EL CEREBRO (L√≥gica Algor√≠tmica)
El sistema no cuenta tickets, cuenta **ESTR√âS ACUMULADO**.

### 4.1 F√≥rmula de Fricci√≥n Din√°mica
$$
	ext{Fricci√≥n Total} = (\text{Puntos Base}) \times (\text{Factor Piloto}) \times (\text{Factor Lote})
$$

**A. Puntos Base (Esfuerzo f√≠sico por item):**
- ü•î Chips: `0.15 pts` (coger y servir).
- üç∫ Bebida: `0.20 pts` (coger y entregar).
- üçî Burger Base: `1.00 pts` (tostar, plancha, montaje est√°ndar).
- üçî‚ú® Burger Custom: `1.20 pts` (montaje complejo + lectura de ticket).

**B. Factor Piloto (Login / Perfil):**
- **Novato:** `x1.2` (el sistema protege antes).
- **Veterano:** `x0.9` (el sistema permite correr).

**C. Factor Lote (Curva de Agobio):**
- Zona Flujo (1-4 items): `x0.9`.
- Zona Colapso (>10 items): `x1.5` (el estr√©s crece exponencialmente).

### 4.2 M√≥dulo Defensa ("El Portero de Discoteca")
- **Trigger:** SI (Puntos Activos > Umbral de Colapso).
- **Acci√≥n:** Kiosco/QR muestran: "Cocina a tope. Tu pedido entrar√° en cola en X min". Desactiva "Recogida Inmediata".

---

## üïπÔ∏è PARTE 5: HARDWARE T√ÅCTICO (El Cockpit)
Las herramientas f√≠sicas del piloto.

### 5.1 M√≥dulo KDS (Pantalla de Cocina)
- Tarjeta de Comanda: Muestra el *Friction Score* (peso del ticket) en lugar del precio.
- Cron√≥metro gamificado: üü¢ Verde (&lt;3m) / üü† Naranja / üî¥ Rojo (&gt;5m).

### 5.2 M√≥dulo IoT ("La Botonera Arcade")
Hardware f√≠sico oculto bajo barra.

- üü¢ **Bot√≥n Verde (BIO-BREAK):** Pausa t√©cnica inmediata.
- üü° **Bot√≥n Amarillo (STOCK):** Cierra ventas 10 min para reposici√≥n.
- üî¥ **Bot√≥n Rojo (FLAG DE ESTR√âS):** No cierra ventas, pero marca el momento para Machine Learning.

---

## üìñ PARTE 6: PLAYBOOK & ESCENARIOS (Manual de Uso)

### ESCENARIO 1: "Modo Dios" (Override)
- **Contexto:** El algoritmo frena por seguridad, pero entra un VIP o el piloto decide acelerar.
- **Acci√≥n:** Pulsas el icono ‚ö° en el KDS.
- **Efecto:** Ignora el "Portero" y el l√≠mite de seguridad durante 15 minutos. Mensaje KDS: "‚ö†Ô∏è SEGURIDAD DESACTIVADA. VUELAS SOLO."

### ESCENARIO 2: El Bio-Break (Urgencia Fisiol√≥gica)
- **Contexto:** Viernes noche. Est√°s solo. Necesitas ir al ba√±o.
- **Acci√≥n:** Pisas el Bot√≥n Verde f√≠sico.
- **Efecto:** Pantallas externas muestran cron√≥metro gigante (05:00). Copy: "PAUSA T√âCNICA DEL PILOTO. Reabasteciendo fluidos. Volvemos en 4:59."

### ESCENARIO 3: Entrenamiento de la Bestia (Machine Learning)
- **Contexto:** Una combinaci√≥n compleja te rompe el ritmo.
- **Acci√≥n:** Golpeas el Bot√≥n Rojo.
- **Efecto:** Env√≠a `stress_event = TRUE`. El sistema aprende y la pr√≥xima vez ajusta puntos de fricci√≥n preventivamente.

### ESCENARIO 4: La Guillotina (Scarcity Marketing)
- **Contexto:** Quedan las √∫ltimas 8 raciones de carne.
- **Acci√≥n:** Mantener pulsado ingrediente (2s) en KDS.
- **Efecto:** Eliminado del men√∫ global. IA lanza aviso a pantallas: "üíÄ ALERTA ZOMBIE: Quedan las √∫ltimas 8 burgers. Corred."

### ESCENARIO 5: IA T√°ctica (Copy por fallo)
- **Contexto:** Se rompe el equipo principal. Vas lento.
- **Acci√≥n:** Chat IA ‚Üí "Tostadora rota".
- **Reacci√≥n:** Genera copy emp√°tico/gracioso para pantallas de espera.

### ESCENARIO 6: El Apag√≥n (Fallo Total)
- **Contexto:** Cae la fibra Y el 4G.
- **Acci√≥n:** Dat√°fono de Respaldo (GPRS). Procedimiento manual de emergencia para cobro y registro (rotulador en la bolsa), con flujo claro para recuperar pedidos posteriores.
- **Resultado:** Lento y feo, pero el dinero sigue entrando.

---

## üìä PARTE 7: POST-GAME (Anal√≠tica)
Al cerrar, recibes el "Damage Report":

- **Coste de Oportunidad:** Dinero perdido por uso de "La Guillotina" (Stock vs Demanda).
- **Mapa de Calor de Estr√©s:** Hora exacta de pulsaciones del Bot√≥n Rojo.
- **Takt Time Real:** Velocidad media de despacho vs. Te√≥rica.

---

## Integraci√≥n con Backlog T√©cnico
Mant√©n esta secci√≥n operativa como referencia de producto; cada ajuste de UX, copy o hardware debe traducirse en una historia de usuario en el backlog t√©cnico. Ejemplos inmediatos:

- [MUST] Implementar Friction Score en KDS y su c√°lculo por receta.
- [MUST] A√±adir trigger "Portero" y UI de bloqueo en kiosco/QR.
- [SHOULD] Integrar botones IoT f√≠sicos con webhooks al backend.

---

## Plan de Funcionalidades (Backlog t√©cnico)
Mant√©n esta secci√≥n como la fuente de verdad para desarrollo ‚Äî cada entrada debe ser una historia de usuario con criterios claros.

### Resumen ejecutivo
Santo Brain busca reducir fricci√≥n operativa y aumentar rentabilidad mediante:
- Centralizar canales de pedido (kiosco, delivery, web).
- Automatizar trazabilidad y stock por receta (escandallo vivo).
- Soportar decisiones mediante anal√≠tica simple (ventas, rotaci√≥n, margen).
- Apoyar operaciones con micro-automatizaciones (etiquetado, alertas, reaprovisionamiento).

### Objetivos (SMART)
- Entregar un MVP en 3 meses que cubra pedidos, escandallo y gesti√≥n de cocina.
- Reducir errores de transcripci√≥n de pedidos en cocina un 90% en 1 mes post-lanzamiento.
- Aumentar ticket medio en un 12% mediante recomendaciones en checkout.

### Alcance del MVP
- Autenticaci√≥n b√°sica (empleado/admin).
- Kiosco web (QR) + Web checkout m√≥vil.
- Integraci√≥n b√°sica con marketplaces (recepci√≥n unificada manual o v√≠a API si existe).
- Escandallo vivo y gesti√≥n de stock por receta.
- Impresi√≥n/etiquetado t√©rmico para producci√≥n.
- Dashboard m√≠nimo: ventas, stock cr√≠tico, top productos.

### M√≥dulos principales
1. Autenticaci√≥n y roles
2. Pedidos (Kiosco / Web / Delivery middleware)
3. Producci√≥n y etiquetas
4. Stock y escandallos
5. Anal√≠tica y reportes
6. Backoffice: productos, precios, promociones
7. Integraciones (impresoras, pasarelas pago, marketplaces)
8. Notificaciones y alertas
9. Configuraci√≥n y seguridad

### Plantilla: Ficha de Funcionalidad
Usa esta plantilla para describir cada feature antes de desarrollarla.

- Nombre: 
- Resumen: 
- Usuario objetivo: (ej. Cliente, Cocinero, Gestor, Admin)
- Historia de usuario: "Como <rol> quiero <acci√≥n> para <beneficio>"
- Criterios de aceptaci√≥n: (lista de √≠tems verificables)
- Prioridad: (MUST / SHOULD / COULD / WON'T)
- Estimaci√≥n: (puntos o d√≠as)
- Dependencias: (m√≥dulos, hardware, APIs)
- Notas t√©cnicas: (si aplica)

---

## Fichas de funcionalidad sugeridas (ejemplos extra√≠das de la Biblia Operativa)

### F1 ‚Äî Friction Score en KDS
- Nombre: Friction Score (KDS)
- Resumen: Calcular y mostrar el Friction Score por ticket en el KDS y usarlo para activar el Portero.
- Usuario objetivo: Cocinero / Operador
- Historia de usuario: "Como cocinero quiero ver el Friction Score para priorizar y saber si el ticket dispara medidas de protecci√≥n." 
- Criterios de aceptaci√≥n:
  - C√°lculo = suma(Puntos Base por item) * Factor Piloto * Factor Lote.
  - Mostrar valor num√©rico y color (verde/naranja/rojo) en la tarjeta de comanda.
  - Emitir evento `friction_threshold_exceeded` si > umbral.
- Prioridad: MUST
- Estimaci√≥n: 5 d√≠as
- Dependencias: DB recetas, perfil piloto, KDS.

### F2 ‚Äî Trigger "Portero" (Protecci√≥n)
- Nombre: Portero / M√≥dulo Defensa
- Resumen: Bloquear recogida inmediata y mostrar mensaje en kiosco cuando el Friction Score supera el umbral.
- Usuario objetivo: Cliente (kiosco) y Cocina
- Historia de usuario: "Como gestor quiero que el kiosco muestre cola y desactive recogida inmediata cuando el sistema est√° bajo estr√©s." 
- Criterios de aceptaci√≥n:
  - Detectar evento `friction_threshold_exceeded` y actualizar estado global a `degraded`.
  - Kiosco muestra mensaje: "Cocina a tope... X min" y desactiva opci√≥n de recogida inmediata.
  - Admin puede forzar override (Modo Dios) durante 15 minutos.
- Prioridad: MUST
- Estimaci√≥n: 4 d√≠as
- Dependencias: F1, Kiosco UI, roles admin.

### F3 ‚Äî Kiosco QR / Checkout m√≥vil
- Nombre: Kiosco QR
- Resumen: Interfaz m√≥vil responsive para autopedido y pago con upsells.
- Usuario objetivo: Cliente en local
- Historia de usuario: "Como cliente quiero pedir y pagar desde mi m√≥vil para evitar cola y obtener incentivos digitales." 
- Criterios de aceptaci√≥n:
  - Men√∫ responsive, selector de variantes y upsells.
  - Pago integrado (Stripe/TPV) y fallback pago en local.
  - Generar ticket que entra al KDS y desencadena impresi√≥n de etiqueta.
- Prioridad: MUST
- Estimaci√≥n: 7-10 d√≠as
- Dependencias: Pasarela pago, impresi√≥n t√©rmica, backoffice productos.

### F4 ‚Äî Botonera IoT (Botones f√≠sicos)
- Nombre: Botonera Arcade
- Resumen: Integrar botones f√≠sicos bajo barra con webhooks para BIO-BREAK, STOCK y FLAG.
- Usuario objetivo: Operador / Cocina
- Historia de usuario: "Como operario quiero pulsar un bot√≥n f√≠sico para marcar pausa o stress_event y que el sistema registre el evento." 
- Criterios de aceptaci√≥n:
  - Botones env√≠an webhook autenticado al backend.
  - Backend registra evento y actualiza estado operativo (pause, close_sales, stress_event).
  - Eventos visibles en KDS y reportados en el Damage Report.
- Prioridad: SHOULD
- Estimaci√≥n: 5 d√≠as (hardware + software)
- Dependencias: Hardware IoT, webhooks, autenticaci√≥n.

### F5 ‚Äî Etiquetado T√©rmico y Trazabilidad
- Nombre: Etiquetado T√©rmico Autom√°tico
- Resumen: Imprimir etiquetas por lotes con fecha, caducidad y lote al pulsar producci√≥n.
- Usuario objetivo: Cocina / Almac√©n
- Historia de usuario: "Como operario quiero imprimir etiquetas que cumplan trazabilidad autom√°ticamente para evitar errores manuales." 
- Criterios de aceptaci√≥n:
  - Integraci√≥n con impresora local y plantilla configurable.
  - Al confirmar producci√≥n se imprime etiqueta con YYYY-MM-DD HH:MM, lote, caducidad.
  - Registro en sistema de trazabilidad por lote.
- Prioridad: SHOULD
- Estimaci√≥n: 3-5 d√≠as
- Dependencias: Driver impresora, API de impresi√≥n.

### F6 ‚Äî La Guillotina (Escasez din√°mica)
- Nombre: Guillotina ‚Äî Scarcity Flow
- Resumen: Permitir eliminar items con long-press y disparar notificaciones de escasez.
- Usuario objetivo: Admin / Operador
- Historia de usuario: "Como operador quiero retirar producto del men√∫ y lanzar mensajes de escasez para gestionar percepci√≥n y demanda." 
- Criterios de aceptaci√≥n:
  - Long-press de 2s en KDS marca item como 'sold_out'.
  - Sistema emite notificaci√≥n a pantallas e inyecta copy '√öltimas N unidades'.
  - Actualiza inventario y evita nuevas ventas del √≠tem.
- Prioridad: COULD
- Estimaci√≥n: 2-3 d√≠as
- Dependencias: KDS, pantallas marketing, inventario.

### F7 ‚Äî Propina en Checkout (Tip + Canalla LED)
- Nombre: Propina (Tip) en Checkout
- Resumen: A√±adir opci√≥n de propina en el checkout (kiosco/web). Al aceptar la propina el sistema reproduce un peque√±o efecto sonoro y muestra un mensaje irreverente/canalla en el "prompt LED" (o en pantallas del local) para reforzar la recompensa social.
- Usuario objetivo: Cliente, Operador
- Historia de usuario: "Como cliente quiero poder dejar una propina sencilla al pagar para apoyar al piloto; como operador quiero el feedback sonoro/visual que confirma la acci√≥n." 
- Criterios de aceptaci√≥n:
  - Mostrar opciones de propina en el checkout (0, 1‚Ç¨, 2‚Ç¨, 5‚Ç¨ o custom).
  - Al confirmar propina, reproducir una notificaci√≥n sonora (beep corto o peque√±a melod√≠a) y disparar un mensaje en el prompt LED con copy canalla/reconocedor.
  - Registrar la propina en la orden y en la contabilidad/export CSV.
  - Permitir deshabilitar el sonido desde configuraci√≥n (privacidad/zonas silenciosas).
- Prioridad: SHOULD
- Estimaci√≥n: 2 d√≠as
- Dependencias: UI Checkout, KDS (para mostrar confirmaci√≥n en cocina si aplica), ajustes en export contable.


---

## Roadmap sugerido (temporal)
1. Mes 0-1: Autenticaci√≥n, Backoffice productos, Escandallo, F1 (Friction Score).
2. Mes 1-2: Kiosco QR (F3), Portero (F2), Etiquetado (F5).
3. Mes 2-3: Botonera IoT (F4), Dashboard KPI, Guillotina (F6).
4. Post-MVP: Integraciones con marketplaces y automatizaciones IA (facturas, sugerencias upsell).

---

## KPIs y m√©tricas (operativo + t√©cnico)
- Tiempo medio desde pedido hasta impresion de etiqueta (objetivo < 30s).
- Error en pedidos recibidos por cocina (% de tickets reingresados). Objetivo < 5%.
- Ticket medio y % incremento por recomendaciones.
- Detecciones de `stress_event` por turno y mapa de calor.
- Tasa de uso de Modo Dios y su impacto en SLA.

---

## Export / Operaciones finales
Si quieres que genere artefactos autom√°ticos: puedo

- Generar un CSV/JSON con las fichas (F1..F6) listo para importar en GitHub Issues/Trello.
- Crear una versi√≥n PDF imprimible y guardarla en `public/assets/santo_brain_v7.pdf`.

---

### ¬øQu√© hago ahora?
- Puedo generar el CSV/JSON con las fichas de ejemplo (F1..F6) ahora. 
- O crear el PDF imprimible.
- O comprobar en el viewer (`plan_viewer_santo_brain.html`) que se ve correcto (necesita servidor local).

